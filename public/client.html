<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VYJ Capital | Perfil de Cliente</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .profile-header {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: #e5e7eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--text-secondary);
        }

        .profile-info h2 {
            margin: 0;
            color: var(--text-primary);
        }

        .profile-info p {
            margin: 0.25rem 0 0;
            color: var(--text-secondary);
        }

        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .evidence-item {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .evidence-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .evidence-preview {
            height: 150px;
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .evidence-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .evidence-preview span {
            font-size: 2rem;
        }

        .evidence-meta {
            padding: 0.75rem;
            font-size: 0.875rem;
        }

        .evidence-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: block;
        }

        .evidence-date {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <header>
            <a href="index.html" class="btn"
                style="background: transparent; color: var(--text-secondary); padding-left: 0;">‚Üê Volver al
                Dashboard</a>
        </header>

        <!-- New Client Form (Hidden by default) -->
        <div id="newClientFormSection" class="card glass" style="display:none; margin-bottom:2rem;">
            <h2 class="section-title"><span>üìù</span> Expediente de Nuevo Cliente</h2>
            <form id="createClientForm" style="display:grid; gap:1.25rem; grid-template-columns: 1fr 1fr;">

                <!-- Secci√≥n 1: Datos Personales -->
                <div
                    style="grid-column: span 2; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-top: 0.5rem;">
                    <h4 style="margin:0; color: var(--primary-color);">üë§ Datos Personales</h4>
                </div>
                <div style="grid-column: span 2;">
                    <label>Nombre Completo</label>
                    <input type="text" id="regName" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="Ej: Maria Perez" required>
                </div>
                <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
                    <div style="flex-grow: 1;">
                        <label>C√©dula / Pasaporte</label>
                        <input type="text" id="regId" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="001-..." required>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="triggerScan('id')"
                        style="padding: 0.75rem; min-height: 48px; border-radius: 12px; display: flex; align-items: center; gap: 0.5rem;">
                        <span>üì∑</span> <small>Escanear</small>
                    </button>
                </div>
                <div>
                    <label>Fecha de Nacimiento</label>
                    <input type="date" id="regDob" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;">
                </div>
                <div>
                    <label>Lugar de Nacimiento</label>
                    <input type="text" id="regPob" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="Ej: Santiago">
                </div>
                <div>
                    <label>Sexo</label>
                    <select id="regGender" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;">
                        <option value="M">Masculino</option>
                        <option value="F">Femenino</option>
                    </select>
                </div>
                <div>
                    <label>Estado Civil</label>
                    <select id="regCivil" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;">
                        <option value="soltero">Soltero/a</option>
                        <option value="casado">Casado/a</option>
                        <option value="union_libre">Uni√≥n Libre</option>
                    </select>
                </div>
                <div>
                    <label>Tel√©fono Personal</label>
                    <input type="tel" id="regPhone" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="(809)..." required>
                </div>
                <div>
                    <label>Correo Electr√≥nico</label>
                    <input type="email" id="regEmail" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="correo@ejemplo.com">
                </div>
                <div style="grid-column: span 2;">
                    <label>Direcci√≥n Residencia / GPS</label>
                    <input type="text" id="regAddress" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;"
                        placeholder="Direcci√≥n exacta o link de Google Maps">
                </div>

                <!-- Secci√≥n 2: Datos Laborales -->
                <div
                    style="grid-column: span 2; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-top: 1rem;">
                    <h4 style="margin:0; color: var(--primary-color);">üíº Informaci√≥n Laboral</h4>
                </div>
                <div>
                    <label>Ocupaci√≥n / Puesto</label>
                    <input type="text" id="regJob" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="Ej: Contadora">
                </div>
                <div>
                    <label>Empresa</label>
                    <input type="text" id="regCompany" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="Nombre de la empresa">
                </div>
                <div>
                    <label>Sueldo Mensual</label>
                    <input type="number" id="regSalary" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="0.00">
                </div>
                <div>
                    <label>Tel√©fono Trabajo</label>
                    <input type="tel" id="regWorkPhone" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="(809)...">
                </div>

                <!-- Secci√≥n 3: Referencias y Fiador -->
                <div
                    style="grid-column: span 2; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-top: 1rem;">
                    <h4 style="margin:0; color: var(--primary-color);">üë• Referencias y Fiador</h4>
                </div>
                <div style="grid-column: span 2;">
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;"><strong>Fiador
                            Solidario</strong></p>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                        <input type="text" id="regSolidarioName" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="Nombre Fiador">
                        <input type="text" id="regSolidarioId" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="C√©dula Fiador">
                        <input type="tel" id="regSolidarioPhone" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="Tel√©fono Fiador">
                        <input type="text" id="regSolidarioJob" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;"
                            placeholder="Referencia Laboral Fiador">
                    </div>
                </div>

                <div style="grid-column: span 2; margin-top: 0.5rem;">
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                        <strong>Referencias Personales</strong>
                    </p>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                        <div style="background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 8px;">
                            <input type="text" id="ref1Name" class="btn-secondary"
                                style="width:100%; padding:0.5rem; border-radius:8px; margin-bottom:0.5rem;"
                                placeholder="Nombre Ref 1">
                            <input type="tel" id="ref1Phone" class="btn-secondary"
                                style="width:100%; padding:0.5rem; border-radius:8px;" placeholder="Tel√©fono Ref 1">
                        </div>
                        <div style="background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 8px;">
                            <input type="text" id="ref2Name" class="btn-secondary"
                                style="width:100%; padding:0.5rem; border-radius:8px; margin-bottom:0.5rem;"
                                placeholder="Nombre Ref 2">
                            <input type="tel" id="ref2Phone" class="btn-secondary"
                                style="width:100%; padding:0.5rem; border-radius:8px;" placeholder="Tel√©fono Ref 2">
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 4: Informaci√≥n de Garant√≠a -->
                <div
                    style="grid-column: span 2; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-top: 1rem;">
                    <h4 style="margin:0; color: var(--primary-color);">üöó Informaci√≥n de Garant√≠a</h4>
                </div>
                <div>
                    <label>Tipo de Garant√≠a</label>
                    <select id="regGuaranteeType" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;">
                        <option value="vehiculo">Veh√≠culo / Motor</option>
                        <option value="electrodomestico">Electrodom√©stico</option>
                        <option value="propiedad">T√≠tulo / Propiedad</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>
                <div>
                    <label>Valor Estimado ($)</label>
                    <input type="number" id="regGuaranteeValue" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="0.00">
                </div>
                <div style="grid-column: span 2; display: flex; gap: 0.5rem; align-items: flex-end;">
                    <div style="flex-grow: 1;">
                        <label>Descripci√≥n detallada de Garant√≠a</label>
                        <textarea id="regGuaranteeDesc" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px; height: 60px;"
                            placeholder="Marca, modelo, a√±o, condici√≥n, placa, etc."></textarea>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="triggerScan('guarantee')"
                        style="padding: 0.75rem; min-height: 60px; border-radius: 12px; display: flex; align-items: center; gap: 0.5rem;">
                        <span>üì∏</span> <small>Subir Fotos</small>
                    </button>
                </div>

                <!-- Secci√≥n 5: Pr√©stamo Inicial (Opcional) -->
                <div
                    style="grid-column: span 2; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-top: 1rem; display: flex; justify-content: space-between; align-items: center;">
                    <h4 style="margin:0; color: var(--primary-color);">üí∞ Pr√©stamo Inicial (Opcional)</h4>
                    <label class="switch" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="enableInitialLoan"
                            onchange="document.getElementById('initialLoanFields').style.display = this.checked ? 'grid' : 'none'">
                        <small>Crear inmediatamente</small>
                    </label>
                </div>

                <div id="initialLoanFields"
                    style="grid-column: span 2; display: none; grid-template-columns: 1fr 1fr; gap: 1.25rem; background: rgba(59, 130, 246, 0.05); padding: 1.5rem; border-radius: 12px; border: 1px dashed var(--primary-color);">
                    <div>
                        <label>Monto Solicitado ($)</label>
                        <input type="number" id="initLoanAmount" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="0.00">
                    </div>
                    <div>
                        <label>Tasa de Inter√©s (%)</label>
                        <div style="display:flex;">
                            <input type="number" id="initLoanRate"
                                style="width:60%; padding:0.75rem; border:1px solid var(--border); border-radius:12px 0 0 12px;">
                            <select id="initLoanRatePeriod"
                                style="width:40%; padding:0.75rem; border:1px solid var(--border); border-left:none; border-radius:0 12px 12px 0; background:#f9fafb;">
                                <option value="mensual">Mensual</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label>Tipo de Amortizaci√≥n</label>
                        <select id="initLoanAmortization" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;">
                            <option value="REDITO_PURO">R√©dito Puro (Solo Inter√©s)</option>
                            <option value="ABONO_CAPITAL">Cuota Fija (Abono Capital)</option>
                        </select>
                    </div>
                    <div>
                        <label>Frecuencia de Pago</label>
                        <select id="initLoanFrequency" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;">
                            <option value="mensual">Mensual</option>
                            <option value="quincenal">Quincenal</option>
                            <option value="semanal">Semanal</option>
                        </select>
                    </div>
                    <div style="grid-column: span 2;">
                        <label>Garant√≠a</label>
                        <textarea id="initLoanGuarantee" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px; height: 60px;"
                            placeholder="Descripci√≥n de la garant√≠a (Veh√≠culo, etc.)"></textarea>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary"
                    style="grid-column: span 2; margin-top: 1rem; height: 50px;">üíæ Guardar Expediente Completo</button>
            </form>
        </div>


        <!-- Dynamic Client Data -->
        <div class="card profile-header glass" id="profileHeader">
            <div class="profile-avatar">üë§</div>
            <div class="profile-info">
                <h2 id="clientName">Cargando cliente...</h2>
                <p id="clientIdDisplay">ID: ...</p>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
                    <p id="clientAddress">üìç ...</p>
                    <p id="clientPhone">üìû ...</p>
                </div>
            </div>
            <div class="header-actions"
                style="margin-left: auto; display: flex; flex-direction: column; gap: 0.5rem; align-items: flex-end;">
                <span class="status-badge status-active" id="clientStatusBadge">ACTIVO</span>
                <button class="btn btn-primary" onclick="document.getElementById('newLoanModal').style.display='flex'">
                    <span>üí∞</span> Nuevo Pr√©stamo
                </button>
            </div>
        </div>

        <div class="grid-container" style="display: grid; grid-template-columns: 2.5fr 1fr; gap: 2rem;">

            <!-- Left Column: Loans & Ficha -->
            <div>
                <!-- Ficha T√©cnica Section -->
                <div id="fichaTecnicaSection" class="card glass" style="margin-bottom: 2rem; display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin:0;">üë§ Ficha T√©cnica Completa</h3>
                        <button class="btn"
                            onclick="document.getElementById('fichaTecnicaSection').style.display='none'"
                            style="font-size: 0.8rem;">Cerrar ‚úï</button>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <!-- Col 1: Personales -->
                        <div>
                            <h4
                                style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-bottom: 1rem; color: var(--primary-color);">
                                Datos Personales</h4>
                            <div style="display: grid; gap: 0.5rem; font-size: 0.95rem;" id="fichaPersonal">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <!-- Col 2: Laborales -->
                        <div>
                            <h4
                                style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-bottom: 1rem; color: var(--primary-color);">
                                Informaci√≥n Laboral</h4>
                            <div style="display: grid; gap: 0.5rem; font-size: 0.95rem;" id="fichaLaboral">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 1.5rem;">
                        <h4
                            style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-bottom: 1rem; color: var(--primary-color);">
                            Referencias y Fiador</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;" id="fichaReferencias">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <h3 class="section-title">Pr√©stamos Activos</h3>
                <div id="loansContainer">
                    <p style="text-align:center; color:#666;">Buscando pr√©stamos...</p>
                </div>
            </div>

            <!-- Right Column: Evidence / Documents -->
            <div>
                <h3 class="section-title">üìÇ Expediente Digital</h3>
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h4 style="margin:0 0 1rem 0; font-size: 0.9rem; color: var(--primary-color);">üîç Auditor√≠a Digital
                        (KYC)</h4>
                    <button class="btn btn-secondary" style="width: 100%; margin-bottom: 1rem;" id="kycMainBtn"
                        onclick="runKYCAudit()">
                        <span>üöÄ</span> Iniciar Auditor√≠a con IA
                    </button>
                    <div id="kycResultsContainer"
                        style="display: none; background: #f9fafb; padding: 1rem; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 1rem;">
                        <p id="kycSummary" style="font-size: 0.85rem; margin-bottom: 0.75rem; font-style: italic;"></p>
                        <div id="kycLinks" style="display: grid; gap: 0.5rem; margin-bottom: 0.75rem;"></div>
                        <div id="kycBadges" style="display: flex; flex-wrap: wrap; gap: 0.4rem;"></div>
                    </div>
                </div>

                <div class="card">
                    <!-- Upload Controls -->
                    <input type="file" id="docUploadInput" style="display: none;" accept="image/*,application/pdf">
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.5rem;"
                        onclick="document.getElementById('fichaTecnicaSection').style.display='block'">üîé Ver Ficha
                        Completa</button>
                    <button class="btn btn-primary"
                        style="width: 100%; margin-bottom: 1rem; background: #f3f4f6; color: var(--text-primary); border: 1px solid var(--border);"
                        onclick="triggerUpload()">+ Subir Documento</button>

                    <!-- Upload Progress -->
                    <div id="uploadProgressContainer"
                        style="display: none; margin-bottom: 1rem; background: #f9fafb; padding: 0.75rem; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <small>Subiendo...</small>
                            <small id="uploadPercent">0%</small>
                        </div>
                        <div
                            style="width: 100%; height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;">
                            <div id="uploadProgressBar"
                                style="width: 0%; height: 100%; background: var(--primary-color); transition: width 0.2s;">
                            </div>
                        </div>
                    </div>


                    <div class="evidence-grid" id="documentsGrid">
                        <p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem; padding: 1rem;">
                            Cargando documentos...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>

    <!-- MODAL: Nuevo Pr√©stamo -->
    <div id="newLoanModal" class="modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
        <div class="card" style="width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                <h2 style="margin:0;">üìù Nuevo Pr√©stamo</h2>
                <button onclick="document.getElementById('newLoanModal').style.display='none'"
                    style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>

            <form id="loanForm">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Monto Solicitado
                            ($)</label>
                        <input type="number" step="0.01" id="loanAmount" class="form-control"
                            style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;">
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Tasa de Inter√©s (%)</label>
                        <div style="display:flex;">
                            <input type="number" step="0.01" id="loanRate"
                                style="width:60%; padding:0.5rem; border:1px solid #ccc; border-top-left-radius:4px; border-bottom-left-radius:4px;">
                            <select id="loanRatePeriod"
                                style="width:40%; padding:0.5rem; border:1px solid #ccc; border-left:none; border-top-right-radius:4px; border-bottom-right-radius:4px; background:#f9fafb;">
                                <option value="mensual">Mensual</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="margin-top:1rem;">
                    <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Tipo de Amortizaci√≥n</label>
                    <select id="loanAmortization" class="form-control"
                        style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;"
                        onchange="toggleAmortizationFields(this.value)">
                        <option value="REDITO_PURO">R√©dito Puro (Solo Inter√©s, Capital al Final)</option>
                        <option value="INTERES_SOBRE_SALDO">Inter√©s s/ Saldo Insoluto (Abonos Capital Permitidos)
                        </option>
                        <option value="ABONO_CAPITAL">Cuota Fija (Amortizaci√≥n Cl√°sica)</option>
                    </select>
                </div>

                <div style="margin-top:1rem; display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Frecuencia de Pago</label>
                        <select id="loanFrequency"
                            style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;">
                            <option value="mensual">Mensual</option>
                            <option value="quincenal">Quincenal</option>
                            <option value="semanal">Semanal</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Plazo (Meses)</label>
                        <input type="number" id="loanTerm" placeholder="Dejar en 0 si es Indefinido"
                            style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;">
                    </div>
                </div>

                <div style="margin-top:1.5rem; border-top:1px solid #eee; padding-top:1rem;">
                    <h4 style="margin:0 0 1rem 0;">Garant√≠a y Fiador</h4>
                    <textarea id="loanGuarantee" placeholder="Descripci√≥n de Garant√≠a (Veh√≠culo, T√≠tulo, etc.)"
                        style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px; margin-bottom:0.5rem;"></textarea>
                    <input type="text" id="loanGuarantor" placeholder="Nombre Fiador Solidario"
                        style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px; margin-bottom:0.5rem;">
                </div>

                <button type="submit" class="btn btn-primary"
                    style="width:100%; margin-top:1.5rem; justify-content:center;">Crear Pr√©stamo</button>
            </form>
        </div>
    </div>

    <!-- MODAL: Registrar Cobro -->
    <div id="paymentModal" class="modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
        <div class="card" style="width: 90%; max-width: 500px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                <h2 style="margin:0;">üí∞ Registrar Cobro</h2>
                <button onclick="document.getElementById('paymentModal').style.display='none'"
                    style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>

            <form id="paymentForm">
                <div style="background:#f3f4f6; padding:1rem; border-radius:8px; margin-bottom:1.5rem;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
                        <span>Inter√©s Pendiente:</span>
                        <strong id="displayInterestPending">$0.00</strong>
                    </div>
                    <div
                        style="display:flex; justify-content:space-between; margin-bottom:0.5rem; color:var(--danger-color);">
                        <span>Mora:</span>
                        <strong id="displayMoraPending">$0.00</strong>
                    </div>
                    <div
                        style="display:flex; justify-content:space-between; border-top:1px solid #ccc; padding-top:0.5rem;">
                        <span>Total a Pagar:</span>
                        <strong id="displayTotalDue">$0.00</strong>
                    </div>
                </div>

                <div style="margin-bottom:1rem;">
                    <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Monto Recibido ($)</label>
                    <input type="number" step="0.01" id="paymentAmount" class="form-control"
                        style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px; font-size:1.2rem; font-weight:bold;">
                </div>

                <div style="margin-bottom:1rem;">
                    <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Tipo de Aplicaci√≥n</label>
                    <select id="paymentType"
                        style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;">
                        <option value="inteligente">Autom√°tico (Mora -> Inter√©s -> Capital)</option>
                        <option value="solo_interes">Solo Inter√©s (Amortizar Deuda)</option>
                        <option value="abono_capital_directo">Abono Extraordinario a Capital</option>
                    </select>
                </div>

                <div style="margin-bottom:1rem;">
                    <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Origen de Fondos</label>
                    <select id="paymentOrigin"
                        style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;">
                        <option value="efectivo">Efectivo</option>
                        <option value="transferencia">Transferencia Bancaria</option>
                        <option value="cheque">Cheque</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary" style="width:100%; justify-content:center;">Procesar Pago
                    & Generar Recibo</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="/__/firebase/10.7.1/firebase-app-compat.js"></script>
    <script src="/__/firebase/10.7.1/firebase-firestore-compat.js"></script>
    <script src="/__/firebase/10.7.1/firebase-storage-compat.js"></script>
    <script src="/__/firebase/10.7.1/firebase-functions-compat.js"></script>
    <script src="/__/firebase/init.js"></script>

    <script src="app.js?v=6"></script>
    <script>
        // Scripts moved to app.js
    </script>
</body>

</html>