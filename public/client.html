<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VYJ Capital | Perfil de Cliente</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>

<body>
    <div class="dashboard-container">
        <header class="flex-between">
            <a href="index.html" class="btn btn-secondary">‚Üê Volver al Dashboard</a>
            <button id="editProfileBtn" class="btn btn-secondary" style="display: none;" onclick="enableEditMode()">
                <span>‚úèÔ∏è</span> Editar Datos
            </button>
        </header>

        <!-- New Client Form (Hidden by default) -->
        <div id="newClientFormSection" class="card mb-2" style="display:none;">
            <h2 class="section-title"><span>üìù</span> Expediente de Nuevo Cliente</h2>
            <form id="createClientForm" class="grid-2">

                <!-- Secci√≥n 1: Datos Personales -->
                <div class="span-2 section-divider">
                    <h4>üë§ Datos Personales</h4>
                </div>
                <div class="span-2">
                    <label>Nombre Completo</label>
                    <input type="text" id="regName" placeholder="Ej: Maria Perez" required>
                </div>
                <div>
                    <label>C√©dula / Pasaporte</label>
                    <input type="text" id="regId" placeholder="001-..." required>
                </div>
                <div>
                    <label>Nacionalidad</label>
                    <input type="text" id="regNationality" placeholder="Ej: Dominicana">
                </div>
                <div class="span-2 ocr-section">
                    <p class="ocr-title">‚ö° Autocompletar con OCR</p>
                    <div class="flex-between gap-1">
                        <button type="button" class="btn btn-secondary w-full" onclick="triggerIDScan('front')">üì∑
                            Frente C√©dula</button>
                        <button type="button" class="btn btn-secondary w-full" onclick="triggerIDScan('back')">üì∑
                            Reverso C√©dula</button>
                    </div>
                    <div id="ocrStatus" style="margin-top: 1rem; display: none;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span id="ocrStatusText"
                                style="font-size: 0.8rem; font-weight: 700; color: var(--primary);">Procesando...</span>
                            <span id="ocrStatusPercent"
                                style="font-size: 0.8rem; font-weight: 800; color: var(--primary);">0%</span>
                        </div>
                        <div
                            style="width: 100%; border-radius: 10px; height: 10px; background: #e2e8f0; overflow: hidden;">
                            <div id="ocrProgressBar"
                                style="width: 0%; height: 100%; background: var(--primary); transition: width 0.3s ease;">
                            </div>
                        </div>
                        <div id="ocrMessage"
                            style="margin-top: 0.5rem; font-size: 0.75rem; padding: 0.5rem; border-radius: 6px; display: none;">
                        </div>
                        <details style="margin-top:0.5rem;">
                            <summary style="font-size:0.7rem; color:var(--text-secondary); cursor:pointer;">Ver texto
                                detectado (Debug)</summary>
                            <pre id="ocrRawText"
                                style="font-size:0.65rem; background:#f8fafc; padding:0.5rem; border-radius:4px; max-height:100px; overflow:auto; white-space:pre-wrap; margin-top:0.25rem; border:1px solid #e2e8f0;"></pre>
                        </details>
                    </div>
                    <!-- Hidden inputs -->
                    <input type="file" id="idFrontInput" accept="image/*" style="display:none;"
                        onchange="handleIDFile(this, 'front')">
                    <input type="file" id="idBackInput" accept="image/*" style="display:none;"
                        onchange="handleIDFile(this, 'back')">
                </div>
                <div>
                    <label>Fecha de Nacimiento</label>
                    <input type="date" id="regDob">
                </div>
                <div>
                    <label>Lugar de Nacimiento</label>
                    <input type="text" id="regBirthPlace" placeholder="Ej: Santiago">
                </div>
                <div>
                    <label>Sexo</label>
                    <select id="regGender">
                        <option value="M">Masculino</option>
                        <option value="F">Femenino</option>
                    </select>
                </div>
                <div>
                    <label>Estado Civil</label>
                    <select id="regCivil">
                        <option value="soltero">Soltero/a</option>
                        <option value="casado">Casado/a</option>
                        <option value="union_libre">Uni√≥n Libre</option>
                    </select>
                </div>
                <div>
                    <label>Tel√©fono Personal</label>
                    <input type="tel" id="regPhone" placeholder="(809)..." required>
                </div>
                <div>
                    <label>Correo Electr√≥nico</label>
                    <input type="email" id="regEmail" placeholder="correo@ejemplo.com">
                </div>
                <div class="span-2">
                    <label>Direcci√≥n Residencia / GPS</label>
                    <input type="text" id="regAddress" placeholder="Direcci√≥n exacta o link de Google Maps">
                </div>

                <!-- Secci√≥n 2: Datos Laborales -->
                <div class="span-2 section-divider">
                    <h4>üíº Informaci√≥n Laboral</h4>
                </div>
                <div>
                    <label>Ocupaci√≥n / Puesto</label>
                    <input type="text" id="regJob" placeholder="Ej: Contadora">
                </div>
                <div>
                    <label>Empresa</label>
                    <input type="text" id="regCompany" placeholder="Nombre de la empresa">
                </div>
                <div>
                    <label>Sueldo Mensual</label>
                    <input type="number" id="regSalary" placeholder="0.00">
                </div>
                <div>
                    <label>Tel√©fono Trabajo</label>
                    <input type="tel" id="regWorkPhone" placeholder="(809)...">
                </div>

                <!-- Secci√≥n 3: Referencias y Fiador -->
                <div class="span-2"
                    style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-top: 1rem;">
                    <h4 style="margin:0; color: var(--primary);">üë• Referencias y Fiador</h4>
                </div>
                <div style="grid-column: span 2;">
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;"><strong>Fiador
                            Solidario</strong></p>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                        <input type="text" id="regSolidarioName" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="Nombre Fiador">
                        <input type="text" id="regSolidarioId" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="C√©dula Fiador">
                        <input type="tel" id="regSolidarioPhone" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="Tel√©fono Fiador">
                        <input type="text" id="regSolidarioJob" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;"
                            placeholder="Referencia Laboral Fiador">
                    </div>
                </div>

                <div style="grid-column: span 2; margin-top: 0.5rem;">
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                        <strong>Referencias Personales</strong>
                    </p>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                        <div style="background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 8px;">
                            <input type="text" id="ref1Name" class="btn-secondary"
                                style="width:100%; padding:0.5rem; border-radius:8px; margin-bottom:0.5rem;"
                                placeholder="Nombre Ref 1">
                            <input type="tel" id="ref1Phone" class="btn-secondary"
                                style="width:100%; padding:0.5rem; border-radius:8px;" placeholder="Tel√©fono Ref 1">
                        </div>
                        <div style="background: rgba(0,0,0,0.02); padding: 0.75rem; border-radius: 8px;">
                            <input type="text" id="ref2Name" class="btn-secondary"
                                style="width:100%; padding:0.5rem; border-radius:8px; margin-bottom:0.5rem;"
                                placeholder="Nombre Ref 2">
                            <input type="tel" id="ref2Phone" class="btn-secondary"
                                style="width:100%; padding:0.5rem; border-radius:8px;" placeholder="Tel√©fono Ref 2">
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 4: Informaci√≥n de Garant√≠a -->
                <div class="span-2"
                    style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-top: 1rem;">
                    <h4 style="margin:0; color: var(--primary);">üöó Informaci√≥n de Garant√≠a</h4>
                </div>
                <div>
                    <label>Tipo de Garant√≠a</label>
                    <select id="regGuaranteeType" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;">
                        <option value="vehiculo">Veh√≠culo / Motor</option>
                        <option value="electrodomestico">Electrodom√©stico</option>
                        <option value="propiedad">T√≠tulo / Propiedad</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>
                <div>
                    <label>Valor Estimado ($)</label>
                    <input type="number" id="regGuaranteeValue" class="btn-secondary"
                        style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="0.00">
                </div>
                <div style="grid-column: span 2; display: flex; gap: 0.5rem; align-items: flex-end;">
                    <div style="flex-grow: 1;">
                        <label>Descripci√≥n detallada de Garant√≠a</label>
                        <textarea id="regGuaranteeDesc" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px; height: 60px;"
                            placeholder="Marca, modelo, a√±o, condici√≥n, placa, etc."></textarea>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="triggerScan('guarantee')"
                        style="padding: 0.75rem; min-height: 60px; border-radius: 12px; display: flex; align-items: center; gap: 0.5rem;">
                        <span>üì∏</span> <small>Subir Fotos</small>
                    </button>
                </div>

                <!-- Secci√≥n 5: Pr√©stamo Inicial (Opcional) -->
                <div class="span-2 flex-between"
                    style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-top: 1rem;">
                    <h4 style="margin:0; color: var(--primary);">üí∞ Pr√©stamo Inicial (Opcional)</h4>
                    <label class="switch" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="enableInitialLoan"
                            onchange="document.getElementById('initialLoanFields').style.display = this.checked ? 'grid' : 'none'">
                        <small>Crear inmediatamente</small>
                    </label>
                </div>

                <div id="initialLoanFields"
                    style="grid-column: span 2; display: none; grid-template-columns: 1fr 1fr; gap: 1.25rem; background: rgba(59, 130, 246, 0.05); padding: 1.5rem; border-radius: 12px; border: 1px dashed var(--primary);">
                    <div>
                        <label>Monto Solicitado ($)</label>
                        <input type="number" id="initLoanAmount" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;" placeholder="0.00">
                    </div>
                    <div>
                        <label>Tasa de Inter√©s (%)</label>
                        <div style="display:flex;">
                            <input type="number" id="initLoanRate"
                                style="width:60%; padding:0.75rem; border:1px solid var(--border); border-radius:12px 0 0 12px;">
                            <select id="initLoanRatePeriod"
                                style="width:40%; padding:0.75rem; border:1px solid var(--border); border-left:none; border-radius:0 12px 12px 0; background:#f9fafb;">
                                <option value="mensual">Mensual</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label>Tipo de Amortizaci√≥n</label>
                        <select id="initLoanAmortization" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;">
                            <option value="REDITO_PURO">R√©dito Puro (Solo Inter√©s)</option>
                            <option value="ABONO_CAPITAL">Cuota Fija (Abono Capital)</option>
                        </select>
                    </div>
                    <div>
                        <label>Frecuencia de Pago</label>
                        <select id="initLoanFrequency" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px;">
                            <option value="mensual">Mensual</option>
                            <option value="quincenal">Quincenal</option>
                            <option value="semanal">Semanal</option>
                        </select>
                    </div>
                    <div style="grid-column: span 2;">
                        <label>Garant√≠a</label>
                        <textarea id="initLoanGuarantee" class="btn-secondary"
                            style="width:100%; padding:0.75rem; border-radius:12px; height: 60px;"
                            placeholder="Descripci√≥n de la garant√≠a (Veh√≠culo, etc.)"></textarea>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary"
                    style="grid-column: span 2; margin-top: 1rem; height: 50px;">üíæ Guardar Expediente Completo</button>
            </form>
        </div>


        <!-- Dynamic Client Data -->
        <div class="card profile-header" id="profileHeader">
            <div class="initials large">üë§</div>
            <div class="profile-info">
                <h2 id="clientName">Cargando cliente...</h2>
                <div class="profile-meta">
                    <span id="clientIdDisplay">ID: ...</span>
                    <span id="clientAddress">üìç ...</span>
                    <span id="clientPhone">üìû ...</span>
                </div>
            </div>
            <div class="header-actions">
                <span class="status-badge status-active" id="clientStatusBadge">ACTIVO</span>
                <button class="btn btn-primary" onclick="document.getElementById('newLoanModal').style.display='flex'">
                    <span>üí∞</span> Nuevo Pr√©stamo
                </button>
            </div>
        </div>

        <div class="grid-container" style="display: grid; grid-template-columns: 2.5fr 1fr; gap: 2rem;">

            <!-- Left Column: Loans & Ficha -->
            <div>
                <!-- Ficha T√©cnica Section -->
                <div id="fichaTecnicaSection" class="card glass" style="margin-bottom: 2rem; display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <h3 style="margin:0;">üë§ Ficha T√©cnica Completa</h3>
                            <button class="btn" onclick="downloadFichaPDF()"
                                style="background: var(--primary); color: white; padding: 0.3rem 0.8rem; font-size: 0.8rem; border-radius: 6px;">üìÑ
                                PDF</button>
                        </div>
                        <button class="btn"
                            onclick="document.getElementById('fichaTecnicaSection').style.display='none'"
                            style="font-size: 0.8rem;">Cerrar ‚úï</button>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <!-- Col 1: Personales -->
                        <div>
                            <h4
                                style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-bottom: 1rem; color: var(--primary);">
                                Datos Personales</h4>
                            <div style="display: grid; gap: 0.5rem; font-size: 0.95rem;" id="fichaPersonal">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <!-- Col 2: Laborales -->
                        <div>
                            <h4
                                style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-bottom: 1rem; color: var(--primary);">
                                Informaci√≥n Laboral</h4>
                            <div style="display: grid; gap: 0.5rem; font-size: 0.95rem;" id="fichaLaboral">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 1.5rem;">
                        <h4
                            style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-bottom: 1rem; color: var(--primary);">
                            Referencias y Fiador</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;" id="fichaReferencias">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <h3 class="section-title">Pr√©stamos Activos</h3>
                <div id="loansContainer">
                    <p style="text-align:center; color:#666;">Buscando pr√©stamos...</p>
                </div>
            </div>

            <!-- Right Column: Evidence / Documents -->
            <div>
                <h3 class="section-title">üìÇ Expediente Digital</h3>
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h4 style="margin:0 0 1rem 0; font-size: 0.9rem; color: var(--primary);">üîç Auditor√≠a Digital
                        (KYC con IA)</h4>
                    <button class="btn btn-secondary" style="width: 100%; margin-bottom: 1rem;" id="kycMainBtn"
                        onclick="runKYCAuditV9()">
                        <span>üöÄ</span> Iniciar Auditor√≠a con IA
                    </button>
                    <div id="kycResultsContainer"
                        style="display: none; background: white; color: var(--text-primary); padding: 1.25rem; border-radius: 8px; border: 2px solid var(--text-primary); margin-bottom: 1.5rem;">
                        <p id="kycSummary" style="font-size: 0.85rem; margin-bottom: 0.75rem; font-style: italic;"></p>
                        <div id="kycLinks" style="display: grid; gap: 0.5rem; margin-bottom: 0.75rem;"></div>
                        <div id="kycBadges" style="display: grid; gap: 0.5rem;"></div>
                    </div>
                </div>

                <!-- WhatsMyName Digital Audit Module -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h4 style="margin:0 0 0.75rem 0; font-size: 0.9rem; color: var(--primary);">üåê Rastreo de
                        Redes Sociales</h4>
                    <p style="font-size: 0.75rem; color: var(--text-secondary); margin: 0 0 1rem 0;">
                        Busca el username del cliente en +500 plataformas con WhatsMyName.
                    </p>

                    <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem;">
                        <input type="text" id="wmnUsernameInput" style="flex: 1;" placeholder="Ej: juan.perez123">
                        <button class="btn btn-primary" id="wmnSearchBtn" onclick="realizarAuditoriaDigital()">
                            üîé Buscar
                        </button>
                    </div>

                    <!-- Loading State -->
                    <div id="wmnLoadingState" style="display: none; text-align: center; padding: 1.5rem 0;">
                        <div
                            style="display: inline-block; width: 32px; height: 32px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite;">
                        </div>
                        <p id="wmnLoadingText"
                            style="font-size: 0.8rem; color: var(--text-secondary); margin: 0.75rem 0 0;">
                            Buscando en plataformas...</p>
                    </div>

                    <!-- Results Container -->
                    <div id="wmnResultsContainer" style="display: none;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <span id="wmnResultCount"
                                style="font-size: 0.8rem; font-weight: 600; color: var(--primary);"></span>
                            <span id="wmnResultSource" style="font-size: 0.7rem; color: var(--text-secondary);"></span>
                        </div>
                        <div id="wmnResultsList"
                            style="display: grid; gap: 0.4rem; max-height: 300px; overflow-y: auto;">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <!-- Upload Controls -->
                    <input type="file" id="docUploadInput" style="display: none;" accept="image/*,application/pdf">
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.75rem;"
                        onclick="document.getElementById('fichaTecnicaSection').style.display='block'">üîé Ver Ficha
                        Completa</button>
                    <button class="btn btn-secondary" style="width: 100%; margin-bottom: 1.5rem;"
                        onclick="triggerUpload()">+ Subir Documento</button>

                    <!-- Upload Progress -->
                    <div id="uploadProgressContainer"
                        style="display: none; margin-bottom: 1rem; background: #f9fafb; padding: 0.75rem; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                            <small>Subiendo...</small>
                            <small id="uploadPercent">0%</small>
                        </div>
                        <div
                            style="width: 100%; height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;">
                            <div id="uploadProgressBar"
                                style="width: 0%; height: 100%; background: var(--primary); transition: width 0.2s;">
                            </div>
                        </div>
                    </div>


                    <div class="evidence-grid" id="documentsGrid">
                        <p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem; padding: 1rem;">
                            Cargando documentos...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>

    <!-- MODAL: Nuevo Pr√©stamo -->
    <div id="newLoanModal" class="modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
        <div class="card" style="width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                <h2 style="margin:0;">üìù Nuevo Pr√©stamo</h2>
                <button onclick="document.getElementById('newLoanModal').style.display='none'"
                    style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>

            <form id="loanForm">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Monto Solicitado
                            ($)</label>
                        <input type="number" step="0.01" id="loanAmount" class="form-control"
                            style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;">
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Tasa de Inter√©s (%)</label>
                        <div style="display:flex;">
                            <input type="number" step="0.01" id="loanRate"
                                style="width:60%; padding:0.5rem; border:1px solid #ccc; border-top-left-radius:4px; border-bottom-left-radius:4px;">
                            <select id="loanRatePeriod"
                                style="width:40%; padding:0.5rem; border:1px solid #ccc; border-left:none; border-top-right-radius:4px; border-bottom-right-radius:4px; background:#f9fafb;">
                                <option value="mensual">Mensual</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="margin-top:1rem;">
                    <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Tipo de Amortizaci√≥n</label>
                    <select id="loanAmortization" class="form-control"
                        style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;"
                        onchange="toggleAmortizationFields(this.value)">
                        <option value="REDITO_PURO">R√©dito Puro (Solo Inter√©s, Capital al Final)</option>
                        <option value="INTERES_SOBRE_SALDO">Inter√©s s/ Saldo Insoluto (Abonos Capital Permitidos)
                        </option>
                        <option value="ABONO_CAPITAL">Cuota Fija (Amortizaci√≥n Cl√°sica)</option>
                    </select>
                </div>

                <div style="margin-top:1rem; display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Frecuencia de Pago</label>
                        <select id="loanFrequency"
                            style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;">
                            <option value="mensual">Mensual</option>
                            <option value="quincenal">Quincenal</option>
                            <option value="semanal">Semanal</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:0.5rem; font-weight:500;">Plazo (Meses)</label>
                        <input type="number" id="loanTerm" placeholder="Dejar en 0 si es Indefinido"
                            style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px;">
                    </div>
                </div>

                <div style="margin-top:1.5rem; border-top:1px solid #eee; padding-top:1rem;">
                    <h4 style="margin:0 0 1rem 0;">Garant√≠a y Fiador</h4>
                    <textarea id="loanGuarantee" placeholder="Descripci√≥n de Garant√≠a (Veh√≠culo, T√≠tulo, etc.)"
                        style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px; margin-bottom:0.5rem;"></textarea>
                    <input type="text" id="loanGuarantor" placeholder="Nombre Fiador Solidario"
                        style="width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:4px; margin-bottom:0.5rem;">
                </div>

                <button type="submit" class="btn btn-primary"
                    style="width:100%; margin-top:1.5rem; justify-content:center;">Crear Pr√©stamo</button>
            </form>
        </div>
    </div>

    <!-- MODAL: Registrar Cobro -->
    <div id="paymentModal" class="modal">
        <div class="card">
            <div class="flex-between mb-2">
                <h2 class="m-0">üí∞ Registrar Cobro</h2>
                <button onclick="document.getElementById('paymentModal').style.display='none'"
                    class="btn-close">&times;</button>
            </div>

            <form id="paymentForm">
                <div class="payment-summary-box mb-2">
                    <div class="flex-between mb-1">
                        <span class="text-muted">Inter√©s Pendiente:</span>
                        <strong id="displayInterestPending" class="text-main">$0.00</strong>
                    </div>
                    <div class="flex-between mb-1">
                        <span class="text-danger">Mora Pendiente:</span>
                        <strong id="displayMoraPending" class="text-danger">$0.00</strong>
                    </div>
                    <div class="flex-between border-top-dark pt-1 mt-1">
                        <span class="text-main-bold">Total a Pagar:</span>
                        <strong id="displayTotalDue" class="text-accent text-xl">$0.00</strong>
                    </div>
                </div>

                <div class="mb-1">
                    <label>Monto Recibido ($)</label>
                    <input type="number" step="0.01" id="paymentAmount" required class="input-lg">
                </div>

                <div class="mb-1">
                    <label>Tipo de Aplicaci√≥n</label>
                    <select id="paymentType">
                        <option value="inteligente">Autom√°tico (Mora -> Inter√©s -> Capital)</option>
                        <option value="solo_interes">Solo Inter√©s (Amortizar Deuda)</option>
                        <option value="abono_capital_directo">Abono Extraordinario a Capital</option>
                    </select>
                </div>

                <div class="mb-2">
                    <label>Origen de Fondos</label>
                    <select id="paymentOrigin">
                        <option value="efectivo">Efectivo</option>
                        <option value="transferencia">Transferencia Bancaria</option>
                        <option value="cheque">Cheque</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary w-full h-lg">
                    Procesar Pago & Generar Recibo
                </button>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="/__/firebase/10.7.1/firebase-app-compat.js"></script>
    <script src="/__/firebase/10.7.1/firebase-firestore-compat.js"></script>
    <script src="/__/firebase/10.7.1/firebase-storage-compat.js"></script>
    <script src="/__/firebase/10.7.1/firebase-functions-compat.js"></script>
    <script src="/__/firebase/init.js"></script>

    <script src="app.js?v=13.3"></script>
    <script>
        // Scripts moved to app.js
    </script>
</body>

</html>